---
page_title: "Provider: terraform-provider-cleaneks"
description: |-
  A provider to bootstrap an EKS cluster by removing **AWS CNI** and **Kube-Proxy**. It will also add the required annotations and labels to import `CoreDNS` into Helm. It will also drop managed by AWS labels from CoreDNS deployment and service.

---

# CleanEKS Provider

The CleanEKS Provider can be used to configure a clean EKS cluster.

When an EKS cluster is created by default AWS CNI, Kube Proxy and CoreDNS are configured for the cluster. This is
done to make the process of using EKS simplier. When using IaC tools this causes problems, as our desired state is
to remove created resources. This provider aims to solve that problem.

In more advanced scenario's you might want to replace AWS CNI that is used with something like Cilium CNI. To get
the full power of Cilium we would want to replace instead of chain Cilium on top of AWS CNI and using Kube Proxy.

The other scenario where this provider is useful is if you want to manage these components yourself with something
like Helm. A pattern that is often followed is called App of Apps, where there is an umbrella Helm chart that calls
all the other helm charts required. Mixing this with a Kubernetes native deployment system like ArgoCD allows a
very easy way to administer a Kubernetes cluster using GitOps.

For example using ArgoCD application CRD to define the core App of Apps for a cluster. So to update CoreDNS you
would update the Helm Chart version in Git and ArgoCD would detect the change and roll out the new version of
CoreDNS. It could also be used to override Helm Chart values for example to configure automatic scaling of CoreDNS
which is **not enabled** by default by AWS.

## Example Usage

```terraform
provider "cleaneks" {
  host                   = data.aws_eks_cluster.cluster.endpoint
  cluster_ca_certificate = base64decode(data.aws_eks_cluster.cluster.certificate_authority[0].data)
  token                  = data.aws_eks_cluster_auth.cluster.token
}

module "eks" {
  source = "terraform-aws-modules/eks/aws"

  enable_cluster_creator_admin_permissions = true # if this is disabled then the deployment user cannot work inside kubernetes cluster
}

data "aws_eks_cluster" "cluster" {
  name       = module.eks.cluster_name
  depends_on = [module.eks]
}

data "aws_eks_cluster_auth" "cluster" {
  name       = module.eks.cluster_name
  depends_on = [module.eks]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `host` (String) The hostname (in form of URI) of Kubernetes master.

### Optional

- `burst_limit` (Number) Helm burst limit. Increase this if you have a cluster with many CRDs
- `client_certificate` (String) PEM-encoded client certificate for TLS authentication. Can be set with `KUBE_CLIENT_CERT_DATA` environment variable.
- `client_key` (String, Sensitive) PEM-encoded client certificate key for TLS authentication. Can be set with `KUBE_CLIENT_KEY_DATA` environment variable.
- `cluster_ca_certificate` (String) PEM-encoded root certificates bundle for TLS authentication. Can be set with `KUBE_CLUSTER_CA_CERT_DATA` environment variable.
- `config_context` (String) Select the Kube context to use. Can be set with `KUBE_CTX` environment variable.
- `config_context_auth_info` (String) Select the Kube authentication context to use. Can be set with `KUBE_CTX_AUTH_INFO` environment variable.
- `config_context_cluster` (String) Select the Kube cluster context to use. Can be set with `KUBE_CTX_CLUSTER` environment variable.
- `config_path` (String) Path to the kube config file. Can be set with `KUBE_CONFIG_PATH`.
- `config_paths` (List of String) A list of paths to kube config files. Can be set with `KUBE_CONFIG_PATHS` environment variable.
- `exec` (Block List) (see [below for nested schema](#nestedblock--exec))
- `insecure` (Boolean) Whether server should be accessed without verifying the TLS certificate. Can be set with `KUBE_INSECURE` environment variable.
- `password` (String, Sensitive) The password to use for HTTP basic authentication when accessing the Kubernetes master endpoint. Can be set with `KUBE_PASSWORD` environment variable.
- `proxy_url` (String) URL to the proxy to be used for all API requests. Can be set with `KUBE_PROXY_URL` environment variable.
- `tls_server_name` (String) Server name passed to the server for SNI and is used in the client to check server certificates against. Can be set with `KUBE_TLS_SERVER_NAME` environment variable.
- `token` (String, Sensitive) Token to authenticate an service account. Can be set with `KUBE_TOKEN` environment variable.
- `username` (String) The username to use for HTTP basic authentication when accessing the Kubernetes master endpoint. Can be set with `KUBE_USER` environment variable.

<a id="nestedblock--exec"></a>
### Nested Schema for `exec`

Required:

- `command` (String) Command to execute

Optional:

- `api_version` (String) The client authentication api Version to use
- `args` (List of List of String) Arguments to pass to the command
- `env` (Map of List of String) Environment variables to set for the command
