---
page_title: "cleaneks_job Resource - terraform-provider-cleaneks"
subcategory: ""
description: |-
  Cleans an EKS cluster of default AWS-CNI, Kube-Proxy and imports CoreDNS deployment and service into Helm. By importing CoreDNS into Helm, we don't loose DNS at any point and we can manage CoreDNS using a Helm chart.
---

# cleaneks_job (Resource)

Cleans an EKS cluster of default AWS-CNI, Kube-Proxy and imports CoreDNS deployment and service into Helm. By importing CoreDNS into Helm, we don't loose DNS at any point and we can manage CoreDNS using a Helm chart.

## Example Usage

```terraform
resource "cleaneks_job" "cluster" {
  endpoint    = data.aws_eks_cluster.cluster.endpoint
  ca_cert_pem = base64decode(data.aws_eks_cluster.cluster.certificate_authority[0].data)
  token       = data.aws_eks_cluster_auth.cluster.token

  remove_aws_cni         = true
  remove_kube_proxy      = true
  import_coredns_to_helm = true
}

module "eks" {
  source = "terraform-aws-modules/eks/aws"

  enable_cluster_creator_admin_permissions = true # if this is disabled then the deployment user cannot work inside kubernetes cluster
}

data "aws_eks_cluster" "cluster" {
  name       = module.eks.cluster_name
  depends_on = [module.eks]
}

data "aws_eks_cluster_auth" "cluster" {
  name       = module.eks.cluster_name
  depends_on = [module.eks]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `endpoint` (String) The Kubernetes endpoint. Supported schemes are `http` and `https`.

### Optional

- `ca_cert_pem` (String) Certificate data of the Certificate Authority (CA) in [PEM (RFC 1421)](https://datatracker.ietf.org/doc/html/rfc1421) format.
- `client_cert_pem` (String) Client Certificate (PEM) to present to the target server.in [PEM (RFC 1421)](https://datatracker.ietf.org/doc/html/rfc1421) format.
- `client_key_pem` (String, Sensitive) Client Certificate (PEM) private Key to use for mTLS.
- `import_coredns_to_helm` (Boolean) Add helm attributes to CoreDns service and deployment, so that it can be managed by Helm.
- `insecure` (Boolean) Disables verification of the server's certificate chain and hostname. Defaults to `false`
- `remove_aws_cni` (Boolean) Remove AWS-CNI from EKS cluster
- `remove_kube_proxy` (Boolean) Remove Kube-Proxy from EKS cluster
- `request_timeout_ms` (Number) The request timeout in milliseconds.
- `token` (String, Sensitive) The Kubernetes token.

### Read-Only

- `aws_cni_daemonset_exists` (Boolean) Does AWS CNI daemonset exist.
- `coredns_deployment_label_amazon_managed_removed` (Boolean) Is label eks.amazonaws.com/component removed.
- `coredns_deployment_label_helm_release_name_set` (Boolean) Does CoreDNS deployment have label meta.helm.sh/release-name with value of coredns.
- `coredns_deployment_label_helm_release_namespace_set` (Boolean) Does CoreDNS deployment have label meta.helm.sh/release-namespace with value of kube-system.
- `coredns_deployment_label_managed_by_set` (Boolean) Does CoreDNS deployment have label app.kubernetes.io/managed-by with value of Helm.
- `coredns_service_label_amazon_managed_removed` (Boolean) Is label eks.amazonaws.com/component removed.
- `coredns_service_label_helm_release_name_set` (Boolean) Does CoreDNS service have label meta.helm.sh/release-name with value of coredns.
- `coredns_service_label_helm_release_namespace_set` (Boolean) Does CoreDNS service have label meta.helm.sh/release-namespace with value of kube-system.
- `coredns_service_label_managed_by_set` (Boolean) Does CoreDNS service have label app.kubernetes.io/managed-by with value of Helm.
- `id` (String) ID of the job. This is the same values as the endpoint.
- `kube_proxy_daemonset_exists` (Boolean) Does Kube-Proxy daemonset exist.