---
page_title: "cleaneks_job Resource - terraform-provider-cleaneks"
subcategory: ""
description: |-
  Cleans an EKS cluster of default AWS-CNI, Kube-Proxy and imports CoreDNS deployment and service into Helm. By importing CoreDNS into Helm, we don't loose DNS at any point and we can manage CoreDNS using a Helm chart.
---

# cleaneks_job (Resource)

Cleans an EKS cluster of default AWS-CNI, Kube-Proxy and imports CoreDNS deployment and service into Helm. By importing CoreDNS into Helm, we don't loose DNS at any point and we can manage CoreDNS using a Helm chart.

## Example Usage

```terraform
resource "cleaneks_job" "cluster" {
  remove_aws_cni         = true
  remove_kube_proxy      = true
  import_coredns_to_helm = true
}

provider "cleaneks" {
  host                   = data.aws_eks_cluster.cluster.endpoint
  cluster_ca_certificate = base64decode(data.aws_eks_cluster.cluster.certificate_authority[0].data)
  token                  = data.aws_eks_cluster_auth.cluster.token
}

module "eks" {
  source = "terraform-aws-modules/eks/aws"

  enable_cluster_creator_admin_permissions = true # if this is disabled then the deployment user cannot work inside kubernetes cluster
}

data "aws_eks_cluster" "cluster" {
  name       = module.eks.cluster_name
  depends_on = [module.eks]
}

data "aws_eks_cluster_auth" "cluster" {
  name       = module.eks.cluster_name
  depends_on = [module.eks]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `import_coredns_to_helm` (Boolean) Add helm attributes to CoreDns service and deployment, so that it can be managed by Helm.
- `remove_aws_cni` (Boolean) Remove **AWS-CNI** from EKS cluster
- `remove_core_dns` (Boolean) Remove **CoreDNS** from EKS cluster
- `remove_kube_proxy` (Boolean) Remove **Kube-Proxy** from EKS cluster

### Read-Only

- `aws_cni_daemonset_exists` (Boolean) Does **AWS CNI** daemonset exist.
- `coredns_config_map_label_amazon_managed_removed` (Boolean) Is label **eks.amazonaws.com/component** removed. Returns **true** if config map does not exist as Helm chart can be deployed.
- `coredns_config_map_label_helm_release_name_set` (Boolean) Does CoreDNS service have label **meta.helm.sh/release-name** with value of **coredns**. Returns **true** if config map does not exist as Helm chart can be deployed.
- `coredns_config_map_label_helm_release_namespace_set` (Boolean) Does CoreDNS service have label **meta.helm.sh/release-namespace** with value of **kube-system**. Returns **true** if config map does not exist as Helm chart can be deployed.
- `coredns_config_map_label_managed_by_set` (Boolean) Does CoreDNS service have label **app.kubernetes.io/managed-by** with value of **Helm**. Returns **true** if config map does not exist as Helm chart can be deployed.
- `coredns_deployment_label_amazon_managed_removed` (Boolean) Is label **eks.amazonaws.com/component** removed. Returns **true** if deployment does not exist as Helm chart can be deployed.
- `coredns_deployment_label_helm_release_name_set` (Boolean) Does CoreDNS deployment have label **meta.helm.sh/release-name** with value of **coredns**. Returns **true** if deployment does not exist as Helm chart can be deployed.
- `coredns_deployment_label_helm_release_namespace_set` (Boolean) Does CoreDNS deployment have label **meta.helm.sh/release-namespace** with value of **kube-system**. Returns **true** if deployment does not exist as Helm chart can be deployed.
- `coredns_deployment_label_managed_by_set` (Boolean) Does CoreDNS deployment have label **app.kubernetes.io/managed-by** with value of **Helm**. Returns **true** if deployment does not exist as Helm chart can be deployed.
- `coredns_pod_disruption_budget_label_amazon_managed_removed` (Boolean) Is label **eks.amazonaws.com/component** removed. Returns **true** if pod disruption budget does not exist as Helm chart can be deployed.
- `coredns_pod_disruption_budget_label_helm_release_name_set` (Boolean) Does CoreDNS service have label **meta.helm.sh/release-name** with value of **coredns**. Returns **true** if pod disruption budget does not exist as Helm chart can be deployed.
- `coredns_pod_disruption_budget_label_helm_release_namespace_set` (Boolean) Does CoreDNS service have label **meta.helm.sh/release-namespace** with value of **kube-system**. Returns **true** if pod disruption budget does not exist as Helm chart can be deployed.
- `coredns_pod_disruption_budget_label_managed_by_set` (Boolean) Does CoreDNS service have label **app.kubernetes.io/managed-by** with value of **Helm**. Returns **true** if pod disruption budget does not exist as Helm chart can be deployed.
- `coredns_service_account_label_amazon_managed_removed` (Boolean) Is label **eks.amazonaws.com/component** removed. Returns **true** if service account does not exist as Helm chart can be deployed.
- `coredns_service_account_label_helm_release_name_set` (Boolean) Does CoreDNS service have label **meta.helm.sh/release-name** with value of **coredns**. Returns **true** if service account does not exist as Helm chart can be deployed.
- `coredns_service_account_label_helm_release_namespace_set` (Boolean) Does CoreDNS service have label **meta.helm.sh/release-namespace** with value of **kube-system**. Returns **true** if service account does not exist as Helm chart can be deployed.
- `coredns_service_account_label_managed_by_set` (Boolean) Does CoreDNS service have label **app.kubernetes.io/managed-by** with value of **Helm**. Returns **true** if service account does not exist as Helm chart can be deployed.
- `coredns_service_label_amazon_managed_removed` (Boolean) Is label **eks.amazonaws.com/component** removed. Returns **true** if service does not exist as Helm chart can be deployed.
- `coredns_service_label_helm_release_name_set` (Boolean) Does CoreDNS service have label **meta.helm.sh/release-name** with value of **coredns**. Returns **true** if service does not exist as Helm chart can be deployed.
- `coredns_service_label_helm_release_namespace_set` (Boolean) Does CoreDNS service have label **meta.helm.sh/release-namespace** with value of **kube-system**. Returns **true** if service does not exist as Helm chart can be deployed.
- `coredns_service_label_managed_by_set` (Boolean) Does CoreDNS service have label **app.kubernetes.io/managed-by** with value of **Helm**. Returns **true** if service does not exist as Helm chart can be deployed.
- `id` (String) ID of the job.
- `kube_proxy_config_map_exists` (Boolean) Does **Kube-Proxy** config map exist.
- `kube_proxy_daemonset_exists` (Boolean) Does **Kube-Proxy** daemonset exist.